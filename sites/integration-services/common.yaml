customiseRoleMapping:
  enabled: true
  mappings:
    # customise role mapping to grant user with 'view' role the ability to run and cancel jobs
    Job-Build: view,edit,admin
    Job-Cancel: view,edit,admin

JCasC:
  defaultConfig: true

  adminAddress: "NZ Integration Jenkins <INTNZ@anz.com>"

  master:
    mode: NORMAL
    numExecutors: 5
    proxy:
      name: "nzswg-app.nz.service.anz"
      port: 80
      noProxyHost: |-
        *.service.dev
        *.test
        *.anz
        *.anznb.co.nz

  quietDown:
    enableScript: true

  anzBitbucket:
    enabled: true
    manageHooks: false
    credentialsId: bitBucketUsernamePasswordCredentials

  pipelineLibraries:
    openshiftPipeline:
      repo: https://bitbucket.nz.service.anz/scm/pipe/openshift-pipeline.git
      credentialsId: bitBucketUsernamePasswordCredentials
      includeInChangesets: true
    datapowerPipelineBB:
      repo: https://bitbucket.nz.service.anz/scm/int/jenkins-pipeline-os.git
      credentialsId: bitBucketUsernamePasswordCredentials
      includeInChangesets: true

  openshiftSync:
    enabled: false

  envVars:
    ARTIFACTORY_REPOSITORY_BASE_URL: https://artifactory.nz.service.anz/artifactory

  vault:
    credentials:
      bitBucketUsernamePasswordCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Service account for BitBucket access"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/bitbucket'
        scope: GLOBAL
        usernameKey: "username"
        passwordKey: "password"

      artifactoryUsernameApiKeyCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Username and API Key for Artifactory"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/artifactory'
        scope: GLOBAL
        usernameKey: "artifactory_username"
        passwordKey: "artifactory_api_key"

      artifactoryStagingUsernameApiKeyCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Username and API Key for Staging Artifactory"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/artifactory'
        scope: GLOBAL
        usernameKey: "staging_artifactory_username"
        passwordKey: "staging_artifactory_api_key"

      devArtifactoryUsernameApiKeyCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Username and API Key for Dev Artifactory"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/artifactory'
        scope: GLOBAL
        usernameKey: "dev_artifactory_username"
        passwordKey: "dev_artifactory_api_key"

      testArtifactoryUsernameApiKeyCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Username and API Key for test Artifactory"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/artifactory'
        scope: GLOBAL
        usernameKey: "test_artifactory_username"
        passwordKey: "test_artifactory_api_key"

      proxyUsernamePasswordCredentials:
        kind: vaultUsernamePasswordCredentialImpl
        description: "Service account to access the corporate proxy"
        path:
          'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/proxy'
        scope: GLOBAL
        usernameKey: "username"
        passwordKey: "password"

      slack:
        kind: vaultStringCredentialImpl
        description: "Token for Slack Integration"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/slack'
        scope: GLOBAL
        vaultKey: "token"

      dependency-track-api-key:
        kind: vaultStringCredentialImpl
        description: "API Key to access dependency track"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/dependency-track'
        scope: GLOBAL
        vaultKey: "api_key"

      checkmarx-token:
        kind: vaultStringCredentialImpl
        description: "CheckMarx token"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/checkmarx'
        scope: GLOBAL
        vaultKey: "token"

      drivetrain-shared-private-key:
        kind: vaultStringCredentialImpl
        description: "private key for Drivetrain"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/drivetrain'
        scope: GLOBAL
        vaultKey: "private_key"

      dynatrace-non-prod-api-key:
        kind: vaultStringCredentialImpl
        description: "API key for Dynatrace Non-Production"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/dynatrace'
        scope: GLOBAL
        vaultKey: "nonprod-token"

      cs1-dev-openshift:
        kind: vaultStringCredentialImpl
        description: "OpenShift service account token for CS1-DEV cluster"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/openshift-service-account'
        scope: GLOBAL
        vaultKey: "cs1-dev-openshift"

      cs2-dev-openshift:
        kind: vaultStringCredentialImpl
        description: "OpenShift service account token for CS2-DEV cluster"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" . }}/credentials/openshift-service-account'
        scope: GLOBAL
        vaultKey: "cs2-dev-openshift"

  openshiftClouds:
    # explicit cloud definition for the non-prod cluster
    openshift_non_prod:
      serverUrl: "" # to be set by individual variants
      namespace: "{{ .Release.Namespace }}"
      credentialsId: "" # to be set by individual variants
      skipTlsVerify: false
      webSocket: true
    # explicit cloud definition for the 2 OCP4 non-prod clusters
    openshift_cs1_dev:
      serverUrl: "https://api.cs1-dev.nz.service.test:6443"
      namespace: "{{ .Release.Namespace }}"
      credentialsId: "cs1-dev-openshift"
      skipTlsVerify: false
      webSocket: true
    openshift_cs2_dev:
      serverUrl: "https://api.cs2-dev.nz.service.test:6443"
      namespace: "{{ .Release.Namespace }}"
      credentialsId: "cs2-dev-openshift"
      skipTlsVerify: false
      webSocket: true

  configScripts:
    content-security-policy: |
      groovy:
        - script: |
            System.setProperty("hudson.model.DirectoryBrowserSupport.CSP", "default-src 'self'; img-src 'self' data:; font-src 'self' data:; style-src 'self' 'unsafe-inline';")
    anonymous-access: |
      groovy:
         - script: |
            {{- .Files.Get "groovy-lib/anonymous-access-helper.groovy" | nindent 6 }}
            setAnonymousAccess(["Overall-Read", "Job-Read"] as String[])

# displayNameSuffix, buildBranchRegex are passed in multi-branch-jobs configuration
FastifyServicesJobsSnippet: |
  bitbucketOrganizationFolder(
    folderName: "Integration Microservices",
    displayName: "Integration Microservices " + displayNameSuffix,
    project: "IMS",
    credentialsId: "bitBucketUsernamePasswordCredentials",
    repoRegex: ".*",
    branchRegex: buildBranchRegex,
  )

FastifyLibsJobsSnippet: |
  bitbucketOrganizationFolder(
    folderName: "Integration Microservices Libraries",
    displayName: "Integration Microservices Libraries " + displayNameSuffix,
    project: "IM",
    credentialsId: "bitBucketUsernamePasswordCredentials",
    repoRegex: "lib.*|integration.*|ims.*",
    branchRegex: buildBranchRegex,
  )

ApiSpecsJobsSnippet: |
  bitbucketOrganizationFolder(
    folderName: "API Spec Governance",
    displayName: "API Spec Governance " + displayNameSuffix,
    project: "ASG",
    credentialsId: "bitBucketUsernamePasswordCredentials",
    repoRegex: ".*",
    branchRegex: buildBranchRegex,
  )
