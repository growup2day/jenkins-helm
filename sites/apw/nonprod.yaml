persistentVolume:
  storage: 50Gi

buildBranchRegex: "feature.*|bugfix.*|hotfix.*"

JCasC:
  master:
    proxy:
      name: "nzswg-app.nz.service.test"
      port: 80
      noProxyHost: |-
        *.service.dev
        *.test
        *.anz
        *.anznb.co.nz
  vault: # https://javadoc.jenkins.io/plugin/hashicorp-vault-plugin/com/datapipe/jenkins/vault/credentials/common/package-summary.html
    vaultUrl: "https://vault-preprod.nzlb.service.test:8200/"
    credentials:
      cs1-dev-openshift:
        kind: vaultStringCredentialImpl
        description: "OpenShift service account token for CS1-DEV cluster"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" .
          }}/credentials/openshift-service-account'
        scope: GLOBAL
        vaultKey: "cs1-dev-openshift"
      cs2-dev-openshift:
        kind: vaultStringCredentialImpl
        description: "OpenShift service account token for CS2-DEV cluster"
        path: 'secret/context/{{ .Release.Namespace }}/{{ include "jenkins.serviceAccountName" .
          }}/credentials/openshift-service-account'
        scope: GLOBAL
        vaultKey: "cs2-dev-openshift"
  configScripts:
    pipeline-jobs: |
      jobs:
        - script: |
            {{- .Files.Get "groovy-lib/pipeline-helper.groovy" | nindent 6 }}

            {{- tpl $.Values.APW_CloudManager_Pipeline_DEV $ | nindent 6 }}
            {{- tpl $.Values.APW_CloudManager_Pipeline_STAGE $ | nindent 6 }}
            {{- tpl $.Values.APW_CloudManager_Pipeline_TEST $ | nindent 6 }}

APW_CloudManager_Pipeline_DEV: |
  bitbucketPipelineJob(
    jobName: "APW CloudManager Pipeline DEV",
    credentialsId: "bitbucketsvc",
    gitUrl: "https://bitbucket.nz.service.anz/scm/apw/anz-aem-public-website---pipeline-definition.git",
    branch: "*/develop",
    scriptPath: "Jenkinsfile",
    shallowCloneDepth: 1,
    triggerBuildOnPush: true,
    pollSCMSpec: null,
    parametersNeeded: true,
    stringParams: [
    [name: 'PIPELINE_BUILD_ENV', defaultValue: 'dev']]
  )

APW_CloudManager_Pipeline_STAGE: |
  bitbucketPipelineJob( 
    jobName: "APW CloudManager Pipeline STAGE",
    credentialsId: "bitbucketsvc",
    gitUrl: "https://bitbucket.nz.service.anz/scm/apw/anz-aem-public-website---pipeline-definition.git",
    branch: "*/master",

    scriptPath: "Jenkinsfile",
    shallowCloneDepth: 1,
    triggerBuildOnPush: true,
    pollSCMSpec: null,
    cronSpec: "H/5 * * * *",
    parametersNeeded: true,
    stringParams: [
    [name: 'PIPELINE_BUILD_ENV', defaultValue: 'stage']]
  )

APW_CloudManager_Pipeline_TEST: |
  bitbucketPipelineJob( 
    jobName: "APW CloudManager Pipeline TEST",
    credentialsId: "bitbucketsvc",
    gitUrl: "https://bitbucket.nz.service.anz/scm/apw/anz-aem-public-website---pipeline-definition.git",
    branch: "*/master",
    scriptPath: "Jenkinsfile",
    shallowCloneDepth: 1,
    triggerBuildOnPush: true,
    pollSCMSpec: null,
    cronSpec: "H/5 * * * *",
    parametersNeeded: true,
    stringParams: [
    [name: 'PIPELINE_BUILD_ENV', defaultValue: 'test']]
  )
